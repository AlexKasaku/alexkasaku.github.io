<!DOCTYPE html>
<html>
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Kasaku">
    <title>A diagnosis of a hanging ASP.NET website - Kasaku</title>
    <meta name="author" content="Kasaku Ltd.">
    <meta name="description" content="Kasaku, a Sitecore consultancy outfit based in London, UK.">
    
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/images/apple-touch-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="/assets/images/apple-touch-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/assets/images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/assets/images/apple-touch-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/assets/images/apple-touch-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/assets/images/apple-touch-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/assets/images/apple-touch-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/assets/images/apple-touch-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon-180x180.png">
	<link rel="icon" type="image/png" href="/assets/images/favicon-32x32.png" sizes="32x32">
	<link rel="icon" type="image/png" href="/assets/images/favicon-194x194.png" sizes="194x194">
	<link rel="icon" type="image/png" href="/assets/images/favicon-96x96.png" sizes="96x96">
	<link rel="icon" type="image/png" href="/assets/images/android-chrome-192x192.png" sizes="192x192">
	<link rel="icon" type="image/png" href="/assets/images/favicon-16x16.png" sizes="16x16">
	<link rel="manifest" href="/assets/images/manifest.json">
	<link rel="shortcut icon" href="/assets/images/favicon.ico">
	<meta name="msapplication-TileColor" content="#333a42">
	<meta name="msapplication-TileImage" content="/assets/images/mstile-144x144.png">
	<meta name="msapplication-config" content="/assets/images/browserconfig.xml">
    <meta name="theme-color" content="#333a42">    
    
    <meta property="og:type"               content="article" />
    <meta property="og:title"              content="A diagnosis of a hanging ASP.NET website - Kasaku" />
    <meta property="og:description"        content="Kasaku, a Sitecore consultancy outfit based in London, UK." />
    <meta property="og:image"              content="https://www.kasaku.co.uk/assets/images/cover.png" />

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@kasaku_dev" />
    <meta name="twitter:title" content="A diagnosis of a hanging ASP.NET website - Kasaku" />
    <meta name="twitter:description" content="Kasaku, a Sitecore consultancy outfit based in London, UK." />
    <meta name="twitter:image" content="https://www.kasaku.co.uk/assets/images/favicon-194x194.png" />    
    
    
        <link rel="alternative" type="application/atom+xml" title="RSS" href="atom.xml">
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style.min.css">
    <!--STYLES END-->
    
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-63800320-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

    <body>
        <div id="blog">
            <header id="header">
    <i id="btn-open-sidebar" class="icon-lg icon-bars "></i>
    <h1 class="header-title">
        <a class="header-title-link" href="https://www.kasaku.co.uk">Kasaku</a>
    </h1>
    
</header>
            <nav id="sidebar">
    
    
    <div class="sidebar-logo">
        <h1><span class="rotate">Kasaku</span></h1>
        <h2>Web Development</h2>
    </div>
    
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link" href="https://www.kasaku.co.uk/">
                    
                    <i class="sidebar-button-icon icon-lg icon-home"></i>
                    <span class="sidebar-button-desc hide-md">Home</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link" href="https://www.kasaku.co.uk/all-tags">
                    
                    <i class="sidebar-button-icon icon-lg icon-tags"></i>
                    <span class="sidebar-button-desc hide-md">Tags</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link" href="https://www.kasaku.co.uk/all-archives">
                    
                    <i class="sidebar-button-icon icon-lg icon-archive"></i>
                    <span class="sidebar-button-desc hide-md">Archives</span>
                </a>
        </li>
        
    </ul>
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
            <a  class="sidebar-button-link" href="https://community.sitecore.net/members/alexwashtell_5f00_911378316" target="_blank">
                
                    <i class="sidebar-button-icon icon-lg icon-sitecore"></i>
                    <span class="sidebar-button-desc hide-md">Sitecore</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
            <a  class="sidebar-button-link" href="https://github.com/kasaku" target="_blank">
                
                    <i class="sidebar-button-icon icon-lg icon-github"></i>
                    <span class="sidebar-button-desc hide-md">GitHub</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
            <a  class="sidebar-button-link" href="https://twitter.com/kasaku_dev" target="_blank">
                
                    <i class="sidebar-button-icon icon-lg icon-twitter"></i>
                    <span class="sidebar-button-desc hide-md">Twitter</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
            <a  class="sidebar-button-link" href="https://stackoverflow.com/users/173983/kasaku" target="_blank">
                
                    <i class="sidebar-button-icon icon-lg icon-stack-overflow"></i>
                    <span class="sidebar-button-desc hide-md">Stack Overflow</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
            <a  class="sidebar-button-link" href="mailto://alex@kasaku.co.uk" target="_blank">
                
                    <i class="sidebar-button-icon icon-lg icon-envelope-o"></i>
                    <span class="sidebar-button-desc hide-md">Mail</span>
                </a>
        </li>
        
    </ul>
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link" href="https://www.kasaku.co.uk/atom.xml">
                    
                    <i class="sidebar-button-icon icon-lg icon-rss"></i>
                    <span class="sidebar-button-desc hide-md">RSS</span>
                </a>
        </li>
        
    </ul>
    
</nav>
            <div id="main">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
        <div class="post-header main-content-wrap">
    
        <h1 class="post-title" itemprop="headline">A diagnosis of a hanging ASP.NET website</h1>
    
    <div class="post-meta">
    <time  itemprop="datePublished" content="Tue Nov 13 2018 23:30:00 GMT+0000">
        Nov 13, 2018
    </time>
    
</div>
</div>
    
    <div class="post-content markdown main-content-wrap" itemprop="articleBody">
        <p>Recently I was experiencing an issue where an ASP.NET site was not appearing to shut down correctly, preventing the application from recycling.</p>
<p>In this specific context, this was a Sitecore site and was reproducable by triggering a change to a configuration file, which causes the application to restart. To confirm the shutdown was happening, I could see the regular shutdown messages appearing in the logs:</p>
<blockquote>
<p>19060 13:13:41 INFO  ************************************************<br>19060 13:13:41 WARN  Sitecore shutting down<br>19060 13:13:41 WARN  Shutdown message: IIS configuration change<br>HostingEnvironment initiated shutdown</p>
</blockquote>
<p>In a typical Sitecore site, this would be followed by the next log file being generated and filled with logs of the initialization process as the site started up again. However, in this particular instance this wasn’t happening. Additionally to this, requests to the site were simply timing out without a response being served.</p>
<p>Before I get into the diagnosis and solution of this problem, it’s worth noting that though this example is based upon a Sitecore ASP.NET site, the diagnosis, issue and required solution <em>are all applicable to a generic ASP.NET site</em>. So if you are not developing a Sitecore site, this blog post could still prove useful to you.</p>
<h2 id="Diagnosis"><a href="#Diagnosis" class="headerlink" title="Diagnosis"></a>Diagnosis</h2><p>To diagnose this issue, I had to do two things. First of all I needed to take a dump of the process in its “hanging” state, so that I could perform some analysis on it to try and find the issue. This can be done in Task Manager. I triggered the shutdown process of the application, and then I created the dump file:</p>
<p><img src="/2018/11/13/diagnosing-hanging-sites/creating-dump-file.png" title="Creating a dump file for the IIS process"></p>

<p>Then, I opened up <a href="https://www.microsoft.com/en-us/download/details.aspx?id=49924" target="_blank" rel="noopener">Microsoft DebugDiag Analysis</a>. This is a useful tool that can help with analysing crashing / hanging issues in Windows processes. Once downloaded, using this is as simple as pointing it at the dump file you’ve just created, selecting <code>CrashHangAnalysis</code> as the analyzer you want to use, and starting the analysis:</p>
<p><img src="/2018/11/13/diagnosing-hanging-sites/debugdiag-guide.png" title="Using DebugDiag to create a report"></p>

<p>The analysis will run and generate you a report. This report is an MHT file, an older HTML web archive file format that you’re best opening with Internet Explorer.</p>
<h1 id="Analysis-and-resolution"><a href="#Analysis-and-resolution" class="headerlink" title="Analysis and resolution"></a>Analysis and resolution</h1><p>Opening the report and looking at the summary immediately showed something promising as a lead to the issue: “The finalizer thread 16 in this w3wp.DMP is blocked”:</p>
<p><img src="/2018/11/13/diagnosing-hanging-sites/report-error.png" title="The DebugDiag report showing the error"></p>

<p> Clicking on the thread number (16) showed more details:</p>
<p><img src="/2018/11/13/diagnosing-hanging-sites/report-thread.png" title="The DebugDiag report giving detail of the thread error"></p>

<p>From this part of the report, I could determine that the thread was stuck waiting in the dispose method of <code>MsieJavaScriptEngine.JsRt.Edge.ChakraEdgeJsRtJsEngine</code>. A quick bit of googling turned up <a href="https://github.com/Taritsyn/MsieJavaScriptEngine/issues/18" target="_blank" rel="noopener">this issue</a> on GitHub for the MsieJavaScriptEngine project. It appeared that there was an issue with the version of the package that we had referenced - the site in question was using React.NET which in turn had taken this package as a dependency.</p>
<p>Fortunately in this instance, the resolution was straightforward. The issue had been fixed in a more recent release of the MsieJavaScriptEngine project, so it was just a case of upgrading the package in the solution. This fixed the issue and the site was able to shutdown / recycle as expected.</p>
<p>Nice and simple! Of course, there could be any multitude of reasons why a site may hang or become unresponsive, and it won’t always be so easy to diagnose. Hopefully what worked here may prove useful to you, and the DebugDiag tool could well assist you in the same way it did in this scenario.</p>

        
            
        
    </div>
    <div class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/bugs/">bugs</a> <a class="tag tag--primary tag--small t-link" href="/tags/react-net/">react.net</a> <a class="tag tag--primary tag--small t-link" href="/tags/sitecore/">sitecore</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--disabled">
                
                    <i class="icon-angle-left"></i>
                    <span class="hide-xs hide-sm text-small mg-icon-l">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2018/03/13/sitecore-settings/" data-tooltip="Useful Sitecore configuration methods">
                
                    <span class="hide-xs hide-sm text-small mg-icon-r">NEXT</span>
                    <i class="icon-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://www.kasaku.co.uk/2018/11/13/diagnosing-hanging-sites/">
                <i class="icon-google-plus"></i>
            </a>
        </li>
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.kasaku.co.uk/2018/11/13/diagnosing-hanging-sites/">
                <i class="icon-facebook-official"></i>
            </a>
        </li>
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://www.kasaku.co.uk/2018/11/13/diagnosing-hanging-sites/">
                <i class="icon-twitter"></i>
            </a>
        </li>
    </ul>
</div>


        
            <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        <img style="vertical-align:middle" src="/assets/images/favicon-32x32.png"/>
        Copyright &copy; 2018 Kasaku Ltd. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div class="post-bottom-bar">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--disabled">
                
                    <i class="icon-angle-left"></i>
                    <span class="hide-xs hide-sm text-small mg-icon-l">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2018/03/13/sitecore-settings/" data-tooltip="Useful Sitecore configuration methods">
                
                    <span class="hide-xs hide-sm text-small mg-icon-r">NEXT</span>
                    <i class="icon-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://www.kasaku.co.uk/2018/11/13/diagnosing-hanging-sites/">
                <i class="icon-google-plus"></i>
            </a>
        </li>
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.kasaku.co.uk/2018/11/13/diagnosing-hanging-sites/">
                <i class="icon-facebook-official"></i>
            </a>
        </li>
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://www.kasaku.co.uk/2018/11/13/diagnosing-hanging-sites/">
                <i class="icon-twitter"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
            
        </div>
        <div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="icon-remove"></i>
        </div>
        
            <h4 id="about-card-name">Kasaku Ltd.</h4>
        
        
        
    </div>
</div>
        	
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/script.min.js"></script>
<!--SCRIPTS END-->

    <script type="text/javascript">
        var disqus_shortname = 'kasaku';
        (function() {
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>


</html>