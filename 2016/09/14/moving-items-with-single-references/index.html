<!DOCTYPE html>
<html>
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Kasaku">
    <title>Moving Datasource items to their pages using Sitecore PowerShell Extensions - Kasaku</title>
    <meta name="author" content="Kasaku Ltd.">
    <meta name="description" content="Kasaku, a Sitecore consultancy outfit based in London, UK.">
    
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/images/apple-touch-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="/assets/images/apple-touch-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/assets/images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/assets/images/apple-touch-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/assets/images/apple-touch-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/assets/images/apple-touch-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/assets/images/apple-touch-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/assets/images/apple-touch-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/assets/images/apple-touch-icon-180x180.png">
	<link rel="icon" type="image/png" href="/assets/images/favicon-32x32.png" sizes="32x32">
	<link rel="icon" type="image/png" href="/assets/images/favicon-194x194.png" sizes="194x194">
	<link rel="icon" type="image/png" href="/assets/images/favicon-96x96.png" sizes="96x96">
	<link rel="icon" type="image/png" href="/assets/images/android-chrome-192x192.png" sizes="192x192">
	<link rel="icon" type="image/png" href="/assets/images/favicon-16x16.png" sizes="16x16">
	<link rel="manifest" href="/assets/images/manifest.json">
	<link rel="shortcut icon" href="/assets/images/favicon.ico">
	<meta name="msapplication-TileColor" content="#333a42">
	<meta name="msapplication-TileImage" content="/assets/images/mstile-144x144.png">
	<meta name="msapplication-config" content="/assets/images/browserconfig.xml">
    <meta name="theme-color" content="#333a42">    
    
    <meta property="og:type"               content="article" />
    <meta property="og:title"              content="Moving Datasource items to their pages using Sitecore PowerShell Extensions - Kasaku" />
    <meta property="og:description"        content="Kasaku, a Sitecore consultancy outfit based in London, UK." />
    <meta property="og:image"              content="https://www.kasaku.co.uk/assets/images/cover.png" />

    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@kasaku_dev" />
    <meta name="twitter:title" content="Moving Datasource items to their pages using Sitecore PowerShell Extensions - Kasaku" />
    <meta name="twitter:description" content="Kasaku, a Sitecore consultancy outfit based in London, UK." />
    <meta name="twitter:image" content="https://www.kasaku.co.uk/assets/images/favicon-194x194.png" />    
    
    
        <link rel="alternative" type="application/atom+xml" title="RSS" href="atom.xml">
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style.min.css">
    <!--STYLES END-->
    
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-63800320-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


</head>

    <body>
        <div id="blog">
            <header id="header">
    <i id="btn-open-sidebar" class="icon-lg icon-bars "></i>
    <h1 class="header-title">
        <a class="header-title-link" href="https://www.kasaku.co.uk">Kasaku</a>
    </h1>
    
</header>
            <nav id="sidebar">
    
    
    <div class="sidebar-logo">
        <h1><span class="rotate">Kasaku</span></h1>
        <h2>Web Development</h2>
    </div>
    
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link" href="https://www.kasaku.co.uk/">
                    
                    <i class="sidebar-button-icon icon-lg icon-home"></i>
                    <span class="sidebar-button-desc hide-md">Home</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link" href="https://www.kasaku.co.uk/all-tags">
                    
                    <i class="sidebar-button-icon icon-lg icon-tags"></i>
                    <span class="sidebar-button-desc hide-md">Tags</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link" href="https://www.kasaku.co.uk/all-archives">
                    
                    <i class="sidebar-button-icon icon-lg icon-archive"></i>
                    <span class="sidebar-button-desc hide-md">Archives</span>
                </a>
        </li>
        
    </ul>
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
            <a  class="sidebar-button-link" href="https://community.sitecore.net/members/alexwashtell_5f00_911378316" target="_blank">
                
                    <i class="sidebar-button-icon icon-lg icon-sitecore"></i>
                    <span class="sidebar-button-desc hide-md">Sitecore</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
            <a  class="sidebar-button-link" href="https://github.com/kasaku" target="_blank">
                
                    <i class="sidebar-button-icon icon-lg icon-github"></i>
                    <span class="sidebar-button-desc hide-md">GitHub</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
            <a  class="sidebar-button-link" href="https://twitter.com/kasaku_dev" target="_blank">
                
                    <i class="sidebar-button-icon icon-lg icon-twitter"></i>
                    <span class="sidebar-button-desc hide-md">Twitter</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
            <a  class="sidebar-button-link" href="https://stackoverflow.com/users/173983/kasaku" target="_blank">
                
                    <i class="sidebar-button-icon icon-lg icon-stack-overflow"></i>
                    <span class="sidebar-button-desc hide-md">Stack Overflow</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
            <a  class="sidebar-button-link" href="mailto://alex@kasaku.co.uk" target="_blank">
                
                    <i class="sidebar-button-icon icon-lg icon-envelope-o"></i>
                    <span class="sidebar-button-desc hide-md">Mail</span>
                </a>
        </li>
        
    </ul>
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link" href="https://www.kasaku.co.uk/atom.xml">
                    
                    <i class="sidebar-button-icon icon-lg icon-rss"></i>
                    <span class="sidebar-button-desc hide-md">RSS</span>
                </a>
        </li>
        
    </ul>
    
</nav>
            <div id="main">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
        <div class="post-header main-content-wrap">
    
        <h1 class="post-title" itemprop="headline">Moving Datasource items to their pages using Sitecore PowerShell Extensions</h1>
    
    <div class="post-meta">
    <time  itemprop="datePublished" content="Wed Sep 14 2016 13:50:01 GMT+0100">
        Sep 14, 2016
    </time>
    
</div>
</div>
    
    <div class="post-content markdown main-content-wrap" itemprop="articleBody">
        <p>Recently on a project I had a need to tidy up the Content tree. In this particular project, renderings on pages made use of Datasource items (best practice, of course!), however rather than keep these items locally to the page in a nested folder, they were all located in a Global folder.<br><a id="more"></a><br>This can certainly work, and it all depends on how you use items, but in this instance it lead to <strong>MANY</strong> items sitting under that Global folder, most of which were only used by a single item.</p>
<p>To tidy this up, I prepared an SPE script that would find items that are only used by a single page and then move them to sit under that item, inside a Content folder.</p>
<p>This is the script:</p>
<figure class="highlight ps"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Identifies Datasource items that only have one single referrer and moves them to</span></div><div class="line"><span class="comment"># a _Content folder that item, creating the folder if necessary.</span></div><div class="line"><span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment"># Item path to find content items within. The script will include all descendants.</span></div><div class="line"><span class="variable">$itemPath</span> = <span class="string">"master:/sitecore/content/MyWebsite/Global Content/StandardText"</span></div><div class="line"></div><div class="line"><span class="comment"># Add template IDs here that you want picked up</span></div><div class="line"><span class="variable">$validTemplates</span> = @(</div><div class="line">    <span class="comment">#"&#123;43DB35A0-E104-4165-B4E9-6E393528B27B&#125;"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="comment"># The template path to use for the Content folder under page items</span></div><div class="line"><span class="variable">$contentFolderTemplatePath</span> = <span class="string">"User Defined/MyWebsite/Folder Templates/Page Content Folder"</span></div><div class="line"></div><div class="line"><span class="comment"># What to name the Content folder when creating</span></div><div class="line"><span class="variable">$contentFolderName</span> = <span class="string">"_Content"</span></div><div class="line"></div><div class="line"><span class="comment"># -------- Script follows --------</span></div><div class="line"></div><div class="line"><span class="variable">$items</span> = <span class="built_in">Get-ChildItem</span> <span class="variable">$itemPath</span> -Recurse</div><div class="line"><span class="variable">$moveCollection</span> = @()</div><div class="line"></div><div class="line"><span class="keyword">foreach</span> ( <span class="variable">$item</span> <span class="keyword">in</span> <span class="variable">$items</span> )</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (!(<span class="variable">$validTemplates</span> <span class="nomarkup">-contains</span> <span class="variable">$item</span>.TemplateID)) &#123;</div><div class="line">        <span class="keyword">continue</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment"># Get the item referrers. As multiple versions of the same referrer will be</span></div><div class="line">    <span class="comment"># returned separately, just get the unique IDs.</span></div><div class="line">    <span class="variable">$itemReferrers</span> = <span class="variable">$item</span> | Get-ItemReferrer -ItemLink | Select  -Expand SourceItemID -Unique</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (<span class="variable">$itemReferrers</span>.Count <span class="nomarkup">-eq</span> <span class="number">0</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">Write-Host</span> <span class="string">"$(<span class="variable">$item</span>.FullPath) has no referrers so can't be moved."</span></div><div class="line">    &#125; <span class="keyword">elseif</span> (<span class="variable">$itemReferrers</span>.Count <span class="nomarkup">-gt</span> <span class="number">1</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="built_in">Write-Host</span> <span class="string">"$(<span class="variable">$item</span>.FullPath) has more than one referrer and will be left. (Count = $(<span class="variable">$itemReferrers</span>.Count))"</span></div><div class="line">    &#125; <span class="keyword">else</span></div><div class="line">    &#123;</div><div class="line">        <span class="comment"># Item has a single referrer, it's a candidate to move.</span></div><div class="line"></div><div class="line">        <span class="variable">$destinationItem</span> = <span class="built_in">Get-Item</span> -Path master: -ID <span class="variable">$itemReferrers</span>[<span class="number">0</span>].Guid -ErrorAction SilentlyContinue</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (<span class="variable">$destinationItem</span>)</div><div class="line">        &#123;</div><div class="line">            <span class="variable">$moveItem</span> = <span class="built_in">New-Object</span> System.Object</div><div class="line">            <span class="variable">$moveItem</span> | <span class="built_in">Add-Member</span> -type NoteProperty -name DatasourceItem -value <span class="variable">$item</span></div><div class="line">            <span class="variable">$moveItem</span> | <span class="built_in">Add-Member</span> -type NoteProperty -name DestinationItem -value <span class="variable">$destinationItem</span></div><div class="line"></div><div class="line">            <span class="variable">$moveCollection</span> += <span class="variable">$moveItem</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span></div><div class="line">        &#123;</div><div class="line">            <span class="built_in">Write-Host</span> <span class="string">"$(<span class="variable">$item</span>.FullPath) has a single referrer, but that item could not be found."</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment"># How many items we've identifed to move</span></div><div class="line"><span class="built_in">Write-Host</span> <span class="variable">$moveCollection</span>.Count</div><div class="line"></div><div class="line"><span class="comment"># If you just want to identify items, uncomment this return.</span></div><div class="line"><span class="comment">#return</span></div><div class="line"></div><div class="line"><span class="comment"># Now perform the move.</span></div><div class="line"><span class="keyword">foreach</span> ( <span class="variable">$moveItem</span> <span class="keyword">in</span> <span class="variable">$moveCollection</span> )</div><div class="line">&#123;</div><div class="line">    <span class="variable">$itemContentFolderPath</span> = <span class="string">"master:"</span> + <span class="variable">$moveItem</span>.DestinationItem.FullPath + <span class="string">"/"</span> + <span class="variable">$contentFolderName</span></div><div class="line">    <span class="variable">$contentFolder</span> = <span class="built_in">Get-Item</span> -Path <span class="variable">$itemContentFolderPath</span>  -ErrorAction SilentlyContinue</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!<span class="variable">$contentFolder</span>) &#123;</div><div class="line">        <span class="comment"># Need to create content folder</span></div><div class="line">        <span class="variable">$contentFolder</span> = <span class="built_in">New-Item</span> -Path <span class="variable">$itemContentFolderPath</span> -ItemType <span class="variable">$contentFolderTemplatePath</span></div><div class="line"></div><div class="line">        <span class="built_in">Write-Host</span> <span class="string">"Created content folder for <span class="variable">$itemContentFolderPath</span>"</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">Write-Host</span> <span class="string">"Moving $(<span class="variable">$moveItem</span>.DatasourceItem.FullPath)"</span></div><div class="line"></div><div class="line">    <span class="built_in">Move-Item</span> -Path <span class="variable">$moveItem</span>.DatasourceItem.FullPath -Destination <span class="variable">$contentFolder</span>.FullPath</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>That’s all there is. The general flow of the script is:</p>
<ul>
<li>Recurse through all items in the content folder specified</li>
<li>Find items that have only 1 referrer. Multiple referrals from different versions of the same item count as 1.</li>
<li>Move those content items to sit under the referrer in a _Content folder. Create the folder if it doesn’t exist.</li>
</ul>
<p>The top-half of the script can be executed (uncomment the return line) if you just want to identify which items can and can’t be moved.</p>

        
            
        
    </div>
    <div class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/powershell/">powershell</a> <a class="tag tag--primary tag--small t-link" href="/tags/sitecore/">sitecore</a> <a class="tag tag--primary tag--small t-link" href="/tags/sitecore-powershell-extensions/">sitecore-powershell-extensions</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/10/26/developer-role-error-in-sitecore-8-1/"  data-tooltip="Developer role error in Sitecore 8.1">
                
                    <i class="icon-angle-left"></i>
                    <span class="hide-xs hide-sm text-small mg-icon-l">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/04/10/importing-csv-data-in-sitecore/" data-tooltip="Using Sitecore Powershell Extensions to import CSV data">
                
                    <span class="hide-xs hide-sm text-small mg-icon-r">NEXT</span>
                    <i class="icon-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://www.kasaku.co.uk/2016/09/14/moving-items-with-single-references/">
                <i class="icon-google-plus"></i>
            </a>
        </li>
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.kasaku.co.uk/2016/09/14/moving-items-with-single-references/">
                <i class="icon-facebook-official"></i>
            </a>
        </li>
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://www.kasaku.co.uk/2016/09/14/moving-items-with-single-references/">
                <i class="icon-twitter"></i>
            </a>
        </li>
    </ul>
</div>


        
            <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        <img style="vertical-align:middle" src="/assets/images/favicon-32x32.png"/>
        Copyright &copy; 2018 Kasaku Ltd. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div class="post-bottom-bar">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/10/26/developer-role-error-in-sitecore-8-1/"  data-tooltip="Developer role error in Sitecore 8.1">
                
                    <i class="icon-angle-left"></i>
                    <span class="hide-xs hide-sm text-small mg-icon-l">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/04/10/importing-csv-data-in-sitecore/" data-tooltip="Using Sitecore Powershell Extensions to import CSV data">
                
                    <span class="hide-xs hide-sm text-small mg-icon-r">NEXT</span>
                    <i class="icon-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://www.kasaku.co.uk/2016/09/14/moving-items-with-single-references/">
                <i class="icon-google-plus"></i>
            </a>
        </li>
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.kasaku.co.uk/2016/09/14/moving-items-with-single-references/">
                <i class="icon-facebook-official"></i>
            </a>
        </li>
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://www.kasaku.co.uk/2016/09/14/moving-items-with-single-references/">
                <i class="icon-twitter"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
            
        </div>
        <div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="icon-remove"></i>
        </div>
        
            <h4 id="about-card-name">Kasaku Ltd.</h4>
        
        
        
    </div>
</div>
        	
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/script.min.js"></script>
<!--SCRIPTS END-->

    <script type="text/javascript">
        var disqus_shortname = 'kasaku';
        (function() {
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>


</html>